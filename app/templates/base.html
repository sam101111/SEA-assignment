<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Document</title>
    

    <script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>


</head>
<body class="">
    <iframe id="preventRedirect" class="hidden"></iframe>
    <div class="nav flex  items-center bg-[#7079D9] text-white text-xl">
        {% if request.headers.cookie %}
            {%set sessionStatus = "Logout" %}
            {%set sessionStatusUrl = "/api/auth/logout" %}

        {% else %}
            {% set sessionStatus = "Login" %}
            {% set sessionStatusUrl = "/login" %}
        {% endif %}
        {% set navElements = [{"title": "Create ticket", "url": "/"}, {"title": "Your issues", "url": "/issues"}, {"title": "Manage issues", "url": "/manage"}, {"title": "Register", "url": "/register"} ,{"title": sessionStatus, "url": sessionStatusUrl }]%}

        <h1 class="text-3xl mx-10"><a href="{{navElements[0].url}}">Help Desk Centre ðŸ†˜</a></h1>
            {% for element in navElements %}
            {% if element.title == "Logout" %}

            <ul>
                <li class="p-4 m-2 cursor-pointer duration-300 hover:text-[#D3D3D3]" >
                <form action="/api/auth/logout" method="post" target="preventRedirect" id="logoutForm">
                <button type="submit">{{element.title}}</button>
                </form>    
                </li>
            </ul>
            {% else %}
            <ul>
                <li class="p-4 m-2 cursor-pointer duration-300 hover:text-[#D3D3D3]" >
                <a href={{element.url}}>{{element.title}}</a>     
                </li>
            </ul>
            {% endif %}
        {% endfor %}

        
   

    </div>


  <div class="flex justify-center items-center h-screen w-screen">
    {% block content%}

    {% endblock %}
</div>

<div id="logoutToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <img src="..." class="rounded me-2" alt="...">
      <strong class="me-auto">Bootstrap</strong>
      <small>11 mins ago</small>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      Hello, world! This is a toast message.
    </div>
<script>
    document.getElementById("logoutForm").addEventListener('submit', (event) => {
        event.preventDefault();
        const formData = new FormData(event.target)
        const logoutToast = document.getElementById("logoutToast")
        const toastInstance = bootstrap.Toast.getOrCreateInstance(logoutToast)
        fetch('/api/auth/logout', {
            method: "POST"
        })
        .then(res => {
            window.location.replace("/login");

        })
        .catch(err => {
            console.log(err)
        })
    })
</script>


</body>
</html>

